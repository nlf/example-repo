name: Rebase Merge

on:
  issue_comment:
    types:
      - created

jobs:
  merge:
    name: Rebase Merge
    if: ${{ github.event.issue.pull_request && github.event.comment.author_association == 'OWNER' && startsWith(github.event.comment.body, '@npm-cli-bot rebase merge') }}
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Rebase
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          PR_REF=$(gh api '${{ github.event.issue.pull_request.url }}' -q .head.ref)
          git fetch origin "$PR_REF"
          git merge "$PR_REF" --ff-only
          git status
